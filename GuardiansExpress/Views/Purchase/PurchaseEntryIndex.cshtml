@model List<GuardiansExpress.Models.Entity.PurchaseDetails>

@{
    int rCnt = 1;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var searchTerm = ViewData["SearchTerm"] as string;
    int currentPage = ViewData["CurrentPage"] as int? ?? 1;
    int totalPages = ViewData["TotalPages"] as int? ?? 1;
    int pageSize = ViewData["PageSize"] as int? ?? 10;
}

<div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-md-12 mt-3">
                <div class="card">
                    <div class="col-lg-12">
                        <div class="pull-right">
                            <form method="get" action="@Url.Action("PurchaseEntryIndex", "Purchase")" style="width:250px">
                                <div class="input-group">
                                    <label class="mt-2 mr-1">No. of records:</label>
                                    <select name="pageSize" id="PageSize" class="form-select" onchange="this.form.submit()">
                                        <option value="50" selected="@(pageSize == 50)">50</option>
                                        <option value="100" selected="@(pageSize == 100)">100</option>
                                        <option value="500" selected="@(pageSize == 500)">500</option>
                                        <option value="1000" selected="@(pageSize == 1000)">1000</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="card-header">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="list-tab" data-bs-toggle="tab" href="#list" role="tab">List of Purchase </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="add-tab" data-bs-toggle="tab" href="#add" role="tab">Add Purchase </a>
                            </li>
                            <li class="nav-item d-none" id="editTabItem">
                                <a class="nav-link" id="edit-tab" data-bs-toggle="tab" href="#edit" role="tab">Edit Purchase</a>
                            </li>
                        </ul>
                    </div>

                    <div class="card-body">
                        <div class="tab-content">
                            <!-- List of Purchase Tab -->
                            <div class="tab-pane fade show active" id="list" role="tabpanel">
                                <div class="table-responsive">
                                    <div class="mt-4" id="purchaseList">
                                        <h5 class="bg-light p-2">Purchase List</h5>
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Date</th>
                                                    <th>Branch</th>
                                                    <th>Acc Head</th>
                                                    <th>Net Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in Model)
                                                {
                                                    <tr>
                                                        <td>@(rCnt++)</td>
                                                        <td>@item.InvoiceDate</td>
                                                        <td>@item.Branch</td>
                                                        <td>@item.ClientName</td>
                                                        <td>@item.NetAmount</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Add Purchase Tab -->
                            <div class="tab-pane fade" id="add" role="tabpanel">
                                <form id="purchaseForm" method="post" action="@Url.Action("SavePurchase", "Purchase")">
                                    <div class="card-header">
                                        <div class="col-md-12 mt-3">
                                            <h5 class="bg-light p-2">Purchase Details</h5>
                                            <div class="row">
                                                <div class="col-md-2">
                                                    <label class="form-label">Branch<span class="text-danger">*</span></label>
                                                    <select class="form-select" name="Branch" required>
                                                        <option>GXPL HYD</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Invoice No.<span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="InvoiceNumber" required>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Invoice Date<span class="text-danger">*</span></label>
                                                    <input type="date" class="form-control" name="InvoiceDate" required>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Client Name<span class="text-danger">*</span></label>
                                                    <div class="d-flex">
                                                        <input type="text" class="form-control" name="ClientName" id="clientNameInput" required>
                                                        <button type="button" class="btn btn-primary" onclick="openAddLedgerMasterModal()">➕</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Select Address<span class="text-danger">*</span></label>
                                                    <select class="form-select" name="SelectAddress" required>
                                                        <option>No Address Found</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">GSTIN</label>
                                                    <input type="text" class="form-control" name="GSTIN">
                                                </div>
                                            </div>

                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Address<span class="text-danger">*</span></label>
                                                    <textarea class="form-control" name="Address" required></textarea>
                                                </div>
                                                <div class="col-md-2 d-flex align-items-center">
                                                    <div class="form-check">
                                                        <input type="hidden" name="NoGST" value="false" />
                                                        <input class="form-check-input" type="checkbox" name="NoGST" id="NoGST" value="true" />
                                                        <label class="form-check-label" for="NoGST"> No GST </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input type="hidden" name="DiscountOnMRP" value="false" />
                                                        <input class="form-check-input" type="checkbox" name="DiscountOnMRP" id="DiscountOnMRP" value="true" />
                                                        <label class="form-check-label" for="DiscountOnMRP"> Discount On MRP </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row mt-3">
                                                <div class="col-md-2">
                                                    <label class="form-label">PO No.</label>
                                                    <select class="form-select" name="PONumber">
                                                        <option>Nothing selected</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">PO Date</label>
                                                    <input type="date" class="form-control" name="PODate">
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Ch. In No.</label>
                                                    <select class="form-select" name="ChallanNumber">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Ch. In Date</label>
                                                    <input type="date" class="form-control" name="ChallanDate">
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Cost Center</label>
                                                    <select class="form-select" name="CostCenter">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-2">
                                                    <label class="form-label">Ewaybill No.</label>
                                                    <input type="text" class="form-control" name="EwaybillNumber">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <h5 class="bg-light p-2">Item Details</h5>
                                    <div class="card-header">
                                        <table class="table table-bordered" id="itemTable">
                                            <thead>
                                                <tr>
                                                    <th>Item & Description</th>
                                                    <th>Purchase Acc</th>
                                                    <th>MRP</th>
                                                    <th>Rate</th>
                                                    <th>Disc(%)</th>
                                                    <th>Qty</th>
                                                    <th>Free Qty</th>
                                                    <th>Amount</th>
                                                    <th>Tax%</th>
                                                    <th>Tax Amt</th>
                                                    <th>Total</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="itemTableBody">
                                                <tr>
                                                    <td><input type="text" class="form-control" name="Items[0].ItemName" placeholder="Item Name"><input type="text" class="form-control" name="Items[0].Description" placeholder="Description"></td>
                                                    <td><input type="text" class="form-control" name="Items[0].PurchaseAcc" placeholder="Purchase Acc"></td>
                                                    <td><input type="number" class="form-control" name="Items[0].MRP" value="0.00"></td>
                                                    <td><input type="number" class="form-control calc" name="Items[0].Rate" value="0.00"></td>
                                                    <td><input type="number" class="form-control calc" name="Items[0].Discount" value="0.00"></td>
                                                    <td><input type="number" class="form-control calc" name="Items[0].Qty" value="0"></td>
                                                    <td><input type="number" class="form-control" name="Items[0].FreeQty" value="0"></td>
                                                    <td><input type="number" class="form-control" name="Items[0].Amount" readonly value="0.00"></td>
                                                    <td>
                                                        <select class="form-select calc" name="Items[0].Tax">
                                                            <option value="0">GST@0%</option>
                                                            <option value="5">GST@5%</option>
                                                            <option value="12">GST@12%</option>
                                                            <option value="18">GST@18%</option>
                                                        </select>
                                                    </td>
                                                    <td><input type="number" class="form-control" name="Items[0].TaxAmt" readonly value="0.00"></td>
                                                    <td><input type="number" class="form-control" name="Items[0].Total" readonly value="0.00"></td>
                                                    <td><button type="button" class="btn btn-danger" onclick="removeRow(this)">X</button></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                       
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="addMoreItem()">Add More</button>
                                    <div class="card-header">
                                        <div class="container mt-4">
                                            <h5 class="bg-light p-2">Total Amount And Tax Details</h5>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label for="Notes" class="form-label">Notes:</label>
                                                    <textarea id="Notes" name="Notes" class="form-control" rows="4" placeholder="Enter any notes..."></textarea>
                                                </div>

                                                <div class="col-md-6">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <td>Gross Amount</td>
                                                            <td><input type="number" class="form-control" id="GrossAmount" name="GrossAmount" step="0.01" value="0.00" readonly></td>
                                                        </tr>
                                                        <tr>
                                                            <td>Discount</td>
                                                            <td><input type="number" class="form-control" id="Discount" name="Discount" step="0.01" value="0.00" readonly></td>
                                                        </tr>
                                                        <tr>
                                                            <td>Tax</td>
                                                            <td><input type="number" class="form-control" id="Tax" name="Tax" step="0.01" value="0.00" readonly></td>
                                                        </tr>
                                                        <tr>
                                                            <td>Round Off</td>
                                                            <td><input type="number" class="form-control" id="RoundOff" name="RoundOff" step="0.01" value="0.00" onchange="calculateFinalAmount()"></td>
                                                        </tr>
                                                        <tr>
                                                            <td><b>Net Amount</b></td>
                                                            <td><b class="text-danger"><input type="number" class="form-control" id="NetAmount" name="NetAmount" step="0.01" value="0.00" readonly></b></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                    <div class="row mt-3">
                                                        <div class="col-md-6">
                                                            <button type="submit" class="btn btn-success">
                                                                <i class="bi bi-check-circle"></i> Save
                                                            </button>
                                                            <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                                                <i class="bi bi-arrow-counterclockwise"></i> Reset
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addLedgerModal" tabindex="-1" aria-labelledby="addLedgerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addLedgerModalLabel">Add Ledger</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="ledgerForm" action="@Url.Action("AddorUpdateLedgerMaster", "LedgerMaster")" method="post">
                    @Html.AntiForgeryToken()
                    <fieldset class="border p-3 mb-3">
                        <legend class="w-auto">Ledger Details</legend>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="AccGroup" class="form-label">Account Group <span class="text-danger">*</span></label>
                                <select class="form-select" id="AccGroup" name="AccGroup" required>
                                    <option value="">Select SubGroup</option>
                                    @if (ViewBag.subgroup != null)
                                    {
                                        foreach (var item in ViewBag.subgroup)
                                        {
                                            <option value="@item.SubGroupName">@item.SubGroupName</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="AccHead" class="form-label">Account Head <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="AccHead" name="AccHead" required>
                            </div>
                            <div class="col-md-6">
                                <label for="TDSPercent" class="form-label">TDS %</label>
                                <input type="number" class="form-control" id="TDSPercent" name="TDSPercent" step="0.01" placeholder="0.00">
                            </div>
                            <div class="col-md-12">
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="BankAccount" name="BankAccount" value="true">
                                    <label for="BankAccount" class="form-check-label">Bank Account</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="TaxLedger" name="TaxLedger" value="true">
                                    <label for="TaxLedger" class="form-check-label">Tax Ledger</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="Taxable" name="Taxable" value="true">
                                    <label for="Taxable" class="form-check-label">Taxable</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input" id="VehicleExpense" name="VehicleExpense" value="true">
                                    <label for="VehicleExpense" class="form-check-label">Vehicle Expense</label>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Contact & Address Details -->
                    <fieldset class="border p-3 mt-3">
                        <legend class="fw-bold d-flex justify-content-between align-items-center">
                            Contact & Address Details
                            <button type="button" class="btn btn-primary" id="addContactBtn">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </legend>
                        <div id="contactForm">
                            <div class="contact-section border p-3 mb-2">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="ContactPerson" class="form-label">Contact Person</label>
                                        <input type="text" class="form-control" id="ContactPerson" name="ContactPerson[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="Mobile" class="form-label">Mobile</label>
                                        <input type="number" class="form-control" id="Mobile" name="Mobile[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="AltMobile" class="form-label">Alt. Mobile</label>
                                        <input type="number" class="form-control" id="AltMobile" name="AltMobile[]">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <label for="Email" class="form-label">Email ID</label>
                                        <input type="email" id="Email" class="form-control" name="Email[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="TelNo" class="form-label">Tel No</label>
                                        <input type="number" id="TelNo" class="form-control" name="TelNo[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="RefID" class="form-label">Ref ID</label>
                                        <input type="text" id="RefID" class="form-control" name="RefID[]">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <label for="CCEmailId" class="form-label">CC Email ID</label>
                                        <input type="email" id="CCEmailId" class="form-control" name="CCEmailId[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="OtherEmailId" class="form-label">Other Email ID</label>
                                        <input type="email" id="OtherEmailId" class="form-control" name="OtherEmailId[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="VendorCode" class="form-label">Vendor Code</label>
                                        <input type="text" id="VendorCode" class="form-control" name="VendorCode[]">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-6">
                                        <label for="Address1" class="form-label">Address 1</label>
                                        <input type="text" id="Address1" class="form-control" name="Address1[]">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="Address2" class="form-label">Address 2</label>
                                        <input type="text" id="Address2" class="form-control" name="Address2[]">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <label for="City" class="form-label">City</label>
                                        <input type="text" id="City" class="form-control" name="City[]">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="State" class="form-label">State*</label>
                                        <select id="State" class="form-control" name="State[]">
                                            <option value="Telangana" selected>Telangana</option>
                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="Pincode" class="form-label">Pincode</label>
                                        <input type="number" id="Pincode" class="form-control" name="Pincode[]">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <label for="Country" class="form-label">Country*</label>
                                        <select class="form-select" id="Country" name="Country[]">
                                            <option value="India" selected>India</option>
                                            <option value="USA">USA</option>
                                            <option value="UK">UK</option>
                                            <option value="Canada">Canada</option>
                                            <option value="Australia">Australia</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Document & Bank Details -->
                    <fieldset class="border p-3 mt-3">
                        <legend class="fw-bold">Document & Bank Details</legend>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="RegistrationType" class="form-label">Registration Type</label>
                                <select class="form-select" id="RegistrationType" name="RegistrationType">
                                    <option value="Composition">Composition</option>
                                    <option value="Consumer">Consumer</option>
                                    <option value="Regular">Regular</option>
                                    <option value="Unregistered">Unregistered</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="PartyType" class="form-label">Party Type</label>
                                <input type="text" class="form-control" id="PartyType" name="PartyType">
                            </div>
                            <div class="col-md-4">
                                <label for="CINNo" class="form-label">CIN No</label>
                                <input type="number" class="form-control" id="CINNo" name="CINNo">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <label for="GSTIN" class="form-label">GSTIN</label>
                                <input type="text" class="form-control" id="GSTIN" name="GSTIN">
                            </div>
                            <div class="col-md-4">
                                <label for="PANNo" class="form-label">PAN No</label>
                                <input type="text" class="form-control" id="PANNo" name="PANNo">
                            </div>
                            <div class="col-md-4">
                                <label for="AAdharNumber" class="form-label">Aadhar No</label>
                                <input type="number" class="form-control" id="AAdharNumber" name="AAdharNumber">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <label for="AccHolderName" class="form-label">Acc. Holder Name</label>
                                <input type="text" class="form-control" id="AccHolderName" name="AccHolderName">
                            </div>
                            <div class="col-md-4">
                                <label for="BankName" class="form-label">Bank Name</label>
                                <input type="text" class="form-control" id="BankName" name="BankName">
                            </div>
                            <div class="col-md-4">
                                <label for="BankAccNo" class="form-label">Bank Acc No</label>
                                <input type="text" class="form-control" id="BankAccNo" name="BankAccNo">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <label for="BankBranch" class="form-label">Bank Branch</label>
                                <input type="text" class="form-control" id="BankBranch" name="BankBranch">
                            </div>
                            <div class="col-md-4">
                                <label for="IFSCCode" class="form-label">IFSC Code</label>
                                <input type="text" class="form-control" id="IFSCCode" name="IFSCCode">
                            </div>
                        </div>
                    </fieldset>

                    <!-- Balance & Other Details -->
                    <fieldset class="border p-3 mt-3">
                        <legend class="fw-bold">Balance & Other Details</legend>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="OpeningBalance" class="form-label">Opening Balance</label>
                                <input type="text" class="form-control" id="OpeningBalance" name="OpeningBalance">
                            </div>
                            <div class="col-md-4">
                                <label for="BalanceIn" class="form-label">Balance In</label>
                                <select class="form-select" id="BalanceIn" name="BalanceIn">
                                    <option value="Credit">Credit</option>
                                    <option value="Debit">Debit</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="PaymentTerm" class="form-label">Payment Term</label>
                                <input type="text" class="form-control" id="PaymentTerm" name="PaymentTerm">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <label for="DueDays" class="form-label">Due Days</label>
                                <input type="number" class="form-control" id="DueDays" name="DueDays">
                            </div>
                            <div class="col-md-4">
                                <label for="Agent" class="form-label">Agent</label>
                                <input type="text" class="form-control" id="Agent" name="Agent">
                            </div>
                            <div class="col-md-4">
                                <label for="UserName" class="form-label">Username</label>
                                <input type="text" class="form-control" id="UserName" name="UserName" autocomplete="off">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <label for="Password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="Password" name="Password" placeholder="**********" autocomplete="off">
                            </div>
                            <div class="col-md-4">
                                <label for="Status" class="form-label">Status*</label>
                                <select class="form-select" id="Status" name="Status">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" id="WalkinLedger" name="WalkinLedger" value="true">
                                    <label class="form-check-label" for="WalkinLedger">Walkin Ledger</label>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Address Details -->
                    <fieldset class="border p-3 mt-3">
                        <legend class="fw-bold text-success">Address Details</legend>
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Branch Name</th>
                                    <th>Name/Address/Mobile</th>
                                    <th>Address</th>
                                    <th>City/State/Pincode</th>
                                    <th>GSTIN</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="addressTableBody">
                                <tr class="addressRow">
                                    <td><input type="text" class="form-control" name="AddressDetails[0].BranchName"></td>
                                    <td><input type="text" class="form-control" name="AddressDetails[0].NameAddressMobile"></td>
                                    <td><input type="text" class="form-control" name="AddressDetails[0].Address"></td>
                                    <td><input type="text" class="form-control" name="AddressDetails[0].CityStatePincode"></td>
                                    <td><input type="text" class="form-control" name="AddressDetails[0].GSTIN"></td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-danger btn-sm removeAddress">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" id="addMoreAddress" class="btn btn-primary">Add More</button>
                    </fieldset>

                    <div class="col-md-6 mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save btn-icon"></i>Save
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-undo btn-icon"></i>Reset
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Function to open the ledger popup
    function openAddLedgerMasterModal() {
        $('#addLedgerModal').modal('show');
    }

    // Function to close the ledger popup
    function closeLedgerPopup() {
        document.getElementById('ledgerPopup').style.display = 'none';
    }

    // Function to select a ledger and update the input field
    function selectLedger(ledgerName) {
        if (selectedInput) {
            selectedInput.value = ledgerName; // Update the input field with the selected ledger
        }
        closeLedgerPopup(); // Close the popup
    }

    // Close the modal if the user clicks outside of it
    window.onclick = function (event) {
        var modal = document.getElementById('ledgerPopup');
        if (event.target == modal) {
            closeLedgerPopup();
        }
    };
        // Global variables
    let itemCounter = 1; // Start from 1 since we already have 0 in the template

    // Function to add a new order item row
    function addOrderItem() {
        const tableBody = document.getElementById('orderItemsTableBody');
        const newRow = document.createElement('tr');

      newRow.innerHTML = `
        <td><input type="text" class="form-control item-name" name="Items[${itemCounter}].Item" required></td>
        <td><input type="text" class="form-control" name="Items[${itemCounter}].ItemDescription"></td>
        <td><input type="text" class="form-control" name="Items[${itemCounter}].HSNSAC"></td>
        <td><input type="text" class="form-control item-mrp" name="Items[${itemCounter}].MRP" value="0.00"></td>
        <td><input type="text" class="form-control item-rate" name="Items[${itemCounter}].Rate" value="0.00" onchange="calculateItemAmount(this)"></td>
        <td><input type="text" class="form-control item-qty" name="Items[${itemCounter}].Quantity" value="1" onchange="calculateItemAmount(this)"></td>
        <td><input type="text" class="form-control" name="Items[${itemCounter}].FreeQuantity" value="0"></td>
        <td><input type="text" class="form-control" name="Items[${itemCounter}].Unit" value="Nos"></td>
        <td><input type="text" class="form-control item-disc" name="Items[${itemCounter}].DiscountPercentage" value="0.00" onchange="calculateItemAmount(this)"></td>
        <td><input type="text" class="form-control item-amount" name="Items[${itemCounter}].Amount" value="0.00" readonly></td>
        <td><input type="text" class="form-control item-tax-percent" name="Items[${itemCounter}].TaxPercentage" value="0.00" onchange="calculateItemAmount(this)"></td>
        <td><input type="text" class="form-control item-tax-amount" name="Items[${itemCounter}].TaxAmount" value="0.00" readonly></td>
        <td><input type="text" class="form-control item-total" name="Items[${itemCounter}].TotalAmount" value="0.00" readonly></td>
        <td><button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">✖</button></td>
    `  ;

        tableBody.appendChild(newRow);
        itemCounter++;
    }
    $(document).ready(function () {
        // Add more address rows
        $("#addMoreAddress").click(function () {
            let rowCount = $("#addressTableBody tr").length; // Get the current number of rows
            let newRow = `
                <tr class="addressRow">
                    <td><input type="text" class="form-control" name="AddressDetails[${rowCount}].BranchName"></td>
                    <td><input type="text" class="form-control" name="AddressDetails[${rowCount}].NameAddressMobile"></td>
                    <td><input type="text" class="form-control" name="AddressDetails[${rowCount}].Address"></td>
                    <td><input type="text" class="form-control" name="AddressDetails[${rowCount}].CityStatePincode"></td>
                    <td><input type="text" class="form-control" name="AddressDetails[${rowCount}].GSTIN"></td>
                    <td class="text-center">
                        <button type="button" class="btn btn-danger btn-sm removeAddress">Delete</button>
                    </td>
                </tr>
            `;
            $("#addressTableBody").append(newRow);
        });

        // Remove an address row
        $(document).on("click", ".removeAddress", function () {
            if ($("#addressTableBody tr").length > 1) { // Ensure at least one row remains
                $(this).closest("tr").remove();
            } else {
                alert("You cannot delete the last row.");
            }
        });
    });

    // Add event listener to the addressTableBody for delete button clicks
    document.getElementById('addressTableBody').addEventListener('click', function (event) {
        // Check if the clicked element has the class 'removeAddress'
        if (event.target.classList.contains('removeAddress')) {
            // Find the closest row (<tr>) and remove it
            const row = event.target.closest('tr');
            if (row && document.querySelectorAll('.addressRow').length > 1) {
                row.remove(); // Remove the row
            } else {
                alert("You cannot delete the last row."); // Prevent deleting the last row
            }
        }
    });

    // Close the modal if the user clicks outside of it
    window.onclick = function (event) {
        var modal = document.getElementById('ledgerPopup');
        if (event.target == modal) {
            closeLedgerPopup();
        }
    };


    document.addEventListener('click', function (event) {
        if (event.target.classList.contains('removeRow')) {
            const rowCount = document.querySelectorAll('#voucherDetailsTable tbody tr').length;
            if (rowCount > 1) {
                event.target.closest('tr').remove();
            } else {
                alert('At least one row is required!');
            }
        }
    });

    // Function to show the purchase list
    function showPurchaseList() {
        const listSection = document.getElementById("purchaseList");
        listSection.style.display = "block";
    }

    function addMoreItem() {
        let table = document.getElementById("itemTable").getElementsByTagName('tbody')[0];
        let newRow = table.rows[0].cloneNode(true);
        newRow.querySelectorAll('input').forEach(input => input.value = '');
        table.appendChild(newRow);
    }

    function removeRow(btn) {
        let row = btn.closest("tr");
        let table = document.getElementById("itemTable");
        if (table.rows.length > 1) {
            row.remove();
        }
    }

    function resetForm() {
        document.getElementById("purchaseForm").reset();
    }
    function addMoreItem() {
        let table = document.getElementById("itemTableBody");
        let rowCount = table.rows.length;

        let newRow = table.rows[0].cloneNode(true);
        newRow.querySelectorAll('input, select').forEach((input) => {
            let name = input.getAttribute('name');
            if (name) {
                input.setAttribute('name', name.replace(/\[\d+\]/, `[${rowCount}]`)); // Update index
            }
            input.value = '';
        });

        table.appendChild(newRow);
    }
    function calculateTotals() {
        let grossAmount = 0, totalDiscount = 0, totalTax = 0, netAmount = 0;

        document.querySelectorAll('#itemTableBody tr').forEach((row) => {
            const rate = parseFloat(row.querySelector('[name$=".Rate"]').value) || 0;
            const qty = parseFloat(row.querySelector('[name$=".Qty"]').value) || 0;
            const discount = parseFloat(row.querySelector('[name$=".Discount"]').value) || 0;
            const taxRate = parseFloat(row.querySelector('[name$=".Tax"]').value) || 0;

            const amount = rate * qty;
            const discountAmt = (amount * discount) / 100;
            const taxAmt = ((amount - discountAmt) * taxRate) / 100;
            const total = amount - discountAmt + taxAmt;

            row.querySelector('[name$=".Amount"]').value = amount.toFixed(2);
            row.querySelector('[name$=".TaxAmt"]').value = taxAmt.toFixed(2);
            row.querySelector('[name$=".Total"]').value = total.toFixed(2);

            grossAmount += amount;
            totalDiscount += discountAmt;
            totalTax += taxAmt;
            netAmount += total;
        });

        document.getElementById('grossAmount').innerText = `₹ ${grossAmount.toFixed(2)}`;
        document.getElementById('totalDiscount').innerText = `₹ ${totalDiscount.toFixed(2)}`;
        document.getElementById('totalTax').innerText = `₹ ${totalTax.toFixed(2)}`;
        document.getElementById('netAmount').innerText = `₹ ${netAmount.toFixed(2)}`;
    }

    function removeRow(button) {
        button.closest('tr').remove();
        calculateTotals();
    }

    document.addEventListener('input', function (e) {
        if (e.target.classList.contains('calc')) {
            calculateTotals();
        }
    });
    // Function to close the ledger popup
    function closeLedgerPopup() {
        document.getElementById('ledgerPopup').style.display = 'none';
    }

    // Function to load the PurchaseList view via AJAX
    function loadPurchaseList() {
        fetch('@Url.Action("PurchaseEntryIndex", "Purchase")') // Replace with your controller and action
            .then(response => response.text())
            .then(data => {
                // Inject the PurchaseList view into the containers
                document.getElementById('PurchaseListContainer').innerHTML = data;
            })
            .catch(error => console.error('Error loading PurchaseList:', error));
    }

    // // Attach event listener to the Cancel button
    // document.getElementById('cancelModal').addEventListener('click', function () {
    //     closeLedgerPopup(); // Close the modal
    //     loadVoucherList();  // Load the VoucherList view
    // });

    // Optional: Close the modal if the user clicks outside of it
    window.onclick = function (event) {
        var modal = document.getElementById('ledgerPopup');
        if (event.target == modal) {
            closeLedgerPopup();
        }
    };

    $(document).ready(function () {
        // Function to show/hide fields when selecting "Sundry Creditors"
        $("#editAccGroup").change(function () {
            let selectedValue = $(this).val();
            if (selectedValue === "Sundry Creditors") {
                $("#editContactAddressField").removeClass("d-none");
                $("#editDocumentBankField").removeClass("d-none");
                $("#editAddressField").removeClass("d-none");
            } else {
                $("#editContactAddressField").addClass("d-none");
                $("#editDocumentBankField").addClass("d-none");
                $("#editAddressField").addClass("d-none");
            }
        });

        // Add More Address Rows in Edit
        $("#addMoreEditAddress").click(function () {
            let newRow = `
                                <tr class="addressRow">
                                    <td><input type="text" class="form-control" name="editBranchName[]"></td>
                                    <td><input type="text" class="form-control" name="editNameAddressMobile[]"></td>
                                    <td><input type="text" class="form-control" name="editAddress[]"></td>
                                    <td><input type="text" class="form-control" name="editCityStatePincode[]"></td>
                                    <td><input type="text" class="form-control" name="editGSTIN[]"></td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-danger btn-sm removeEditAddress">Delete</button>
                                    </td>
                                </tr>
                                `;

            $("#editAddressTableBody").append(newRow);
        });

        // Remove Address Row in Edit
        $(document).on("click", ".removeEditAddress", function () {
            if ($("#editAddressTableBody").children().length > 1) {
                $(this).closest("tr").remove();
            } else {
                Swal.fire("Warning!", "At least one address row is required.", "warning");
            }
        });
    });
    // Add event listener to the addressTableBody for delete button clicks
    document.getElementById('addressTableBody').addEventListener('click', function (event) {
        // Check if the clicked element has the class 'removeAddress'
        if (event.target.classList.contains('removeAddress')) {
            // Find the closest row (<tr>) and remove it
            const row = event.target.closest('tr');
            if (row && document.querySelectorAll('.addressRow').length > 1) {
                row.remove(); // Remove the row
            } else {
                alert("You cannot delete the last row."); // Prevent deleting the last row
            }
        }
    });

    $(document).ready(function () {
    $("#AccGroup").change(function () {
    var selectedValue = $(this).val();
    if (selectedValue === "Sundry Creditors") {
    $("fieldset:has(legend:contains('Balance and Other Details'))").hide();
    } else {
    $("fieldset:has(legend:contains('Balance and Other Details'))").show();
    }
    });

    // Trigger change event on page load to set initial visibility
    $("#AccGroup").trigger("change");
    });
</script>


